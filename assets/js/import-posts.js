function print_Msg(e,n){var t=document.createElement("div");"notice"!=n&&"warning"!=n&&"error"!=n||(t.className="message-entry",t.className+="notice"==n?" notice-message":"warning"==n?" warning-message":" error-message"),t.innerHTML=e,document.getElementById("Msg-container").prepend(t)}function preventPOST(e){e.preventDefault()}function get_inputValue(e){var n=document.getElementById(e);return""==n.value?null:n.value}function get_credentials(){var e={DBHost:get_inputValue("database-host"),DBName:get_inputValue("database-name"),DBUser:get_inputValue("database-user"),DBPass:get_inputValue("database-pass"),StartID:get_inputValue("start-from-id")};for(var n in e)return null==e[n]?(print_Msg("please fill out "+n+" field.","error"),1):e}function getPHPHandlerLocation(e){for(var n,t=/(\S+)import-clanku\//g,o=document.location.href;null!==(n=t.exec(o));){n.index===t.lastIndex&&t.lastIndex++;return n[1]+"wp-content/themes/zs-hroznova/template-parts/php-import-content-handlers/"+e}}function checkConnectionsToDBs(e){connectionCheckRequest=new XMLHttpRequest;var n=getPHPHandlerLocation("db-connection-test.php"),t="DBName="+encodeURIComponent(e.DBNameExport)+"&";return t+="DBUser="+encodeURIComponent(e.DBUserExport)+"&",t+="DBPass="+encodeURIComponent(e.DBPassExport),connectionCheckRequest.open("POST",n,!1),connectionCheckRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),connectionCheckRequest.send(t),200===connectionCheckRequest.status?JSON.parse(connectionCheckRequest.responseText):(console.log("Status code returned from db-connection-test.php: "+connectionCheckRequest.status),1)}function countItemsToProcess(e){connectionCount=new XMLHttpRequest;var n=getPHPHandlerLocation("db-count-items.php"),t="DBName="+encodeURIComponent(e.DBName)+"&";return t+="DBUser="+encodeURIComponent(e.DBUser)+"&",t+="DBPass="+encodeURIComponent(e.DBPass)+"&",t+="StartID="+encodeURIComponent(e.StartID),connectionCount.open("POST",n,!1),connectionCount.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),connectionCount.send(t),200===connectionCount.status?JSON.parse(connectionCount.responseText):(console.log("Status code returned from get-number-of-images.php: "+connectionCount.status),1)}function importPost(e,n){connectionImport=new XMLHttpRequest;var t=getPHPHandlerLocation("../import-post.php"),o="DBName="+encodeURIComponent(n.DBName)+"&";return o+="DBUser="+encodeURIComponent(n.DBUser)+"&",o+="DBPass="+encodeURIComponent(n.DBPass)+"&",o+="currentID="+encodeURIComponent(e),connectionImport.open("POST",t,!1),connectionImport.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),connectionImport.send(o),200===connectionImport.status?JSON.parse(connectionImport.responseText):(console.log("Status code returned from import-post.php: "+connectionImport.status),1)}function setupProgressBar(e){var n=document.getElementById("submit-form");n.className+=" import-button-progress-bar",n.childNodes[0].nextSibling.innerHTML="Importing . . . (<span id='current-progress-number'>0</span>/<span id='final-progress-number'>"+e+"</span>)";var t=document.createElement("div");t.id="progress-line",n.prepend(t),n.removeEventListener("click",importHandler),n.addEventListener("click",preventPOST)}function updateProgressBar(e){var n=1-e/(finalCount/100)/100;console.log(n),document.getElementById("current-progress-number").innerHTML=e,document.getElementById("progress-line").style.transform="scaleX("+n+")"}function importHandler(e){e.preventDefault();var n=get_credentials();if(console.log(n),1==n)return console.log("couldn't contiue after trying to get credentials."),1;var t=checkConnectionsToDBs(n);if(1===t.DBCon)return print_Msg("error occured connection to Export database: "+t.ExException,"error"),1;print_Msg("Connection established.","notice");var o=countItemsToProcess(n);if(console.log(o),-1===o.Count)return print_Msg("Couldn't count remaining pictures.","error"),1;setupProgressBar(o.Count),finalCount=o.Count;var r=0;currentID=o.FirstID;var s=setInterval(function(){if(r<2){var e=importPost(currentID,n);console.log(e),!0===e.created?(print_Msg("New item from ID["+currentID+"] was imported<br>Date: "+e.Date+"<br>Title: "+e.Title+"<br>Content: "+e.Content,"notice"),r++,currentID=e.nextID,updateProgressBar(r)):(r++,print_Msg("Item with ID["+currentID+"] was not imported","warning"))}else clearInterval(s)},1e3)}var startPostID=0;startPostID=document.getElementById("start-from-id").value;var currentID=-1,finalCount=0;document.getElementById("submit-form").addEventListener("click",importHandler);