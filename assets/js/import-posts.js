var startPostID=0;startPostID=document.getElementById("start-from-id").value;var currentID=-1,finalCount=0;function print_Msg(e,t){var n=document.createElement("div");"notice"!=t&&"warning"!=t&&"error"!=t||(n.className="message-entry",n.className+="notice"==t?" notice-message":"warning"==t?" warning-message":" error-message"),n.innerHTML=e,document.getElementById("Msg-container").prepend(n)}function preventPOST(e){e.preventDefault()}function get_inputValue(e){var t=document.getElementById(e);return""==t.value?null:t.value}function get_credentials(){var e={DBHost:get_inputValue("database-host"),DBName:get_inputValue("database-name"),DBUser:get_inputValue("database-user"),DBPass:get_inputValue("database-pass"),StartID:get_inputValue("start-from-id")};for(var t in e)return null==e[t]?(print_Msg("please fill out "+t+" field.","error"),1):e}function getPHPHandlerLocation(e){return magicalData.siteURL+"/wp-content/themes/zs-hroznova/template-parts/php-import-content-handlers/"+e}function checkConnectionsToDBs(e){connectionCheckRequest=new XMLHttpRequest;var t=getPHPHandlerLocation("db-connection-test.php"),n="DBName="+encodeURIComponent(e.DBNameExport)+"&";return n+="DBUser="+encodeURIComponent(e.DBUserExport)+"&",n+="DBPass="+encodeURIComponent(e.DBPassExport),connectionCheckRequest.open("POST",t,!1),connectionCheckRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),connectionCheckRequest.send(n),200===connectionCheckRequest.status?JSON.parse(connectionCheckRequest.responseText):(console.log("Status code returned from db-connection-test.php: "+connectionCheckRequest.status),1)}function countItemsToProcess(e){connectionCount=new XMLHttpRequest;var t=getPHPHandlerLocation("db-count-items.php"),n="DBName="+encodeURIComponent(e.DBName)+"&";return n+="DBUser="+encodeURIComponent(e.DBUser)+"&",n+="DBPass="+encodeURIComponent(e.DBPass)+"&",n+="StartID="+encodeURIComponent(e.StartID),connectionCount.open("POST",t,!1),connectionCount.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),connectionCount.send(n),200===connectionCount.status?JSON.parse(connectionCount.responseText):(console.log("Status code returned from get-number-of-images.php: "+connectionCount.status),1)}function importPost(e,t){connectionImport=new XMLHttpRequest;var n=getPHPHandlerLocation("import-post.php"),o="DBName="+encodeURIComponent(t.DBName)+"&";return o+="DBUser="+encodeURIComponent(t.DBUser)+"&",o+="DBPass="+encodeURIComponent(t.DBPass)+"&",o+="currentID="+encodeURIComponent(e),connectionImport.open("POST",n,!1),connectionImport.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),connectionImport.send(o),200===connectionImport.status?JSON.parse(connectionImport.responseText):(console.log("Status code returned from import-post.php: "+connectionImport.status),1)}function setupProgressBar(e){var t=document.getElementById("submit-form");t.className+=" import-button-progress-bar",t.childNodes[0].nextSibling.innerHTML="Importing . . . (<span id='current-progress-number'>0</span>/<span id='final-progress-number'>"+e+"</span>)";var n=document.createElement("div");n.id="progress-line",t.prepend(n),t.removeEventListener("click",importHandler),t.addEventListener("click",preventPOST)}function updateProgressBar(e){var t=1-e/(finalCount/100)/100;document.getElementById("current-progress-number").innerHTML=e,document.getElementById("progress-line").style.transform="scaleX("+t+")"}function importHandler(e){e.preventDefault();var t=get_credentials();if(1==t)return console.log("couldn't contiue after trying to get credentials."),1;var n=checkConnectionsToDBs(t);if(1===n.DBCon)return print_Msg("error occured connection to Export database: "+n.ExException,"error"),1;print_Msg("Connection established.","notice");var r=countItemsToProcess(t);if(console.log(r),-1===r.Count)return print_Msg("Couldn't count remaining pictures.","error"),1;setupProgressBar(r.Count),finalCount=r.Count;var s=0;currentID=r.FirstID;var a=setInterval(function(){if(s<=r.Count){var n=importPost(currentID,t);console.log(n);var o=currentID;if(currentID=n.nextID,-1!==n.nextID){n.Categories.forEach(function(t){RPcreateCategories(t,function(e){-1===e.status?print_Msg("Tried to create category :"+t+", but got exception: <br>"+e.exception,"warning"):(n.CategoryIDs.push(e.id),t===n.Categories[n.Categories.length-1]&&(console.log("create post NOW!"),RPcreatePost(n,function(e){-1===e.status?print_Msg("Tried to create post :"+n.Title+", but got exception: <br>"+e.exception,"warning"):0===e.status?print_Msg('Post with title: "'+n.Title+'" already exists.',"warning"):print_Msg("New item with ID["+o+"] was imported<br>Date: "+n.Date+"<br>Title: "+n.Title+"<br>Content: "+n.Content,"notice")})))})})}else print_Msg("Item with ID["+o+"] was not loaded","warning");updateProgressBar(s),s++}else clearInterval(a)},1e3)}document.getElementById("submit-form").addEventListener("click",importHandler);